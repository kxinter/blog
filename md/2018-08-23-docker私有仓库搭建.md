---
title: docker私有仓库搭建
tags:
  - 私有仓库
  - 部署
  - docker
categories:
  - Docker
date: 2018-08-23 16:17:08
copyright: true
---

# 1 搭建仓库
<!--more-->
安装docker-ce,过程省略…….；运行以下命令启动仓库

``` crystal
$ docker run --name registry --restart always -d -p 5000:5000 -v /.registry:/var/lib/registry registry
```

# 2 修改配置

修改所有需要使用私有仓库的docker服务器（包括仓库服务器）的docker配置，在/etc/docker目录创建daemon.json文件内容如下：
``` vala
# 下面这句表示表示开启5000端口的非安全模式，也就是http模式，否则在push或pull时会报https错误
{ "insecure-registries":["192.168.1.11:5000"] }
# 下面这句是使用阿里云镜像加速，提高外网官方仓库的下载速度，这里一起列出了，不是必须要添加的，和私有仓库没有关系。
{
  "registry-mirrors": ["https://cz0az3lb.mirror.aliyuncs.com"]
}
```
可以同时设置，写法如下

``` json
{
"insecure-registries":["192.168.1.118:5000"],
"registry-mirrors": ["http://192.168.1.118:5001"]
}
```
重启docker服务，配置生效

# 3 查询仓库镜像列表

``` bash
[root@zabbix-11 docker]# curl -XGET http://192.168.1.11:5000/v2/_catalog
{"repositories":["nginx"]}
# 显示镜像nginx

# 查询镜像版本

``` elixir
[root@zabbix-11 docker]# curl -XGET http://192.168.1.11:5000/v2/nginx/tags/list
{"name":"nginx","tags":["1","1.13.7"]}
#查询nginx镜像的版本号，有1/1.13.7版本
```
以上查询也可以在web页面查询，复制命令后方http链接地址就行。