---
title: zabbix监控项自定义
tags:
  - zabbix
categories:
  - Linux
copyright: true
date: 2019-08-08 09:24:19
---

# 1 防火墙状态监控

## 1.1 在被监控主机配置监控脚本
<!--more-->
### 1.1.1 监控脚本
在`/usr/local/zabbix/scripts/`下创建脚本`firewalld_status.sh`
**内容如下：**
``` bash
#!/bin/bash

stat=`systemctl status firewalld|grep Active|awk '{print $3}'|cut -c 2-8`

if [ $stat == running ];then
   echo 1
else
   echo 0
fi
```
脚本含义：打印防火墙状态，截取运行状态字符，如果是running输出1，否则输出0

### 1.1.2 设置键值
在`/etc/zabbix/zabbix_agentd.d`目录下创建配置文件
{%note warning%}**配置文件后缀必须是`.conf`**
{%endnote%}

#创建配置文件`firewalld_status.conf`
#添加如下内容,设置键值`status.firewalld`
``` bash
UserParameter=status.firewalld,/usr/local/zabbix/scripts/firewalld_status.sh
```
## 1.2 创建监控项
自定义名称，输入上方定义的键值为`status.firewalld`
![1](1.jpg)
## 1.3 创建触发器
检测键值输出，如果输出为0，则触发告警。
![2](2.jpg)
# 2 端口监控
## 2.1 创建监控项
`net.tcp.listen[port]` 检查 TCP 端口 是否处于侦听状态。返回 0 - 未侦听；1 - 正在侦听
![3](3.jpg)
## 2.2 创建触发器
检测最后的返回结果，如果是0触发告警
![4](4.jpg)
# 3 进程监控
## 3.1 创建监控项
`proc.num[<name>,<user>,<state>,<cmdline>]`	进程数。返回整数
![5](5.jpg)
## 3.2 创建触发器
如果进程数量为0,触发告警
![6](6.jpg)