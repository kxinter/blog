---
title: Oracle-11g-R2安装教程
tags:
  - oracle
categories:
  - Linux
copyright: true
date: 2018-08-20 07:36:34
---

# 一、安装Oracle前准备
<!--more-->
## 1.创建运行oracle数据库的系统用户和用户组

``` bash
[sonny@localhost ~]$ su root　　#切换到root
Password: 
[root@localhost sonny]# groupadd oinstall　　#创建用户组oinstall
[root@localhost sonny]# groupadd dba　　#创建用户组dba
[root@localhost sonny]# useradd -g oinstall -g dba -m oracle　　#创建oracle用户，并加入到oinstall和dba用户组
[root@localhost sonny]# passwd oracle　　#设置用户oracle的登陆密码，不设置密码，在CentOS的图形登陆界面没法登陆
Changing password for user oracle.
New password: 　　# 密码
BAD PASSWORD: The password is shorter than 8 characters
Retype new password: 　　# 确认密码
passwd: all authentication tokens updated successfully.
[root@localhost sonny]# id oracle # 查看新建的oracle用户
uid=1001(oracle) gid=1002(dba) groups=1002(dba)
[root@localhost sonny]#
```

## 2.创建oracle数据库安装目录

``` bash
[sonny@localhost ~]$ su root
Password: 
[root@localhost sonny]# mkdir -p /data/oracle　　#oracle数据库安装目录
[root@localhost sonny]# mkdir -p /data/oraInventory　　#oracle数据库配置文件目录
[root@localhost sonny]# mkdir -p /data/database　　#oracle数据库软件包解压目录
[root@localhost sonny]# cd /data
[root@localhost data]# ls　　#创建完毕检查一下（强迫症）
database  oracle  oraInventory
[root@localhost data]# chown -R oracle:oinstall /data/oracle　　#设置目录所有者为oinstall用户组的oracle用户
[root@localhost data]# chown -R oracle:oinstall /data/oraInventory
[root@localhost data]# chown -R oracle:oinstall /data/database
[root@localhost data]#
```

## 3.修改OS系统标识

oracle默认不支持CentOS系统安装，Oracle Database 11g Release 2 的 OS要求参考： https://docs.oracle.com/cd/E11882_01/install.112/e47689/pre_install.htm#LADBI1106

我安装是64位数据库，On Linux x86-64：Red Hat Enterprise Linux 7  （RHEL 7）

另外，CentOS7.0.1511 基于 RHEL7.2  参考：http://www.linuxidc.com/Linux/2015-12/126283.htm

修改文件 /etc/RedHat-release

``` elixir
[sonny@localhost data]$ su root
Password: 
[root@localhost data]# cat /proc/version 
Linux version 3.10.0-327.el7.x86_64 (builder@kbuilder.dev.centos.org) (gcc version 4.8.3 20140911 (Red Hat 4.8.3-9) (GCC) ) #1 SMP Thu Nov 19 22:10:57 UTC 2015
[root@localhost data]# cat /etc/redhat-release　　
CentOS Linux release 7.2.1511 (Core) 
[root@localhost data]# vi /etc/redhat-release
[root@localhost data]# cat /etc/redhat-release 
redhat-7 
[root@localhost data]#
```

## 4.安装oracle数据库所需要的软件包

重复一遍，我安装时Oracle Database 11g Release 2 64位数据库。

Oracle Database Package Requirements for Linux x86-64 如下：（参考：https://docs.oracle.com/cd/E11882_01/install.112/e47689/pre_install.htm#BABCFJFG）

``` mipsasm
操作系统:Oracle Linux 7 and Red Hat Enterprise Linux 7
The following packages (or later versions) must be installed:

$ yum install binutils compat-libstdc++ compat-libstdc++-33 elfutils-libelf-devel gcc gcc-c++ glibc-devel glibc-headers ksh libaio-devel libstdc++-devel make sysstat unixODBC-devel binutils-* compat-libstdc++* elfutils-libelf* glibc* gcc-* libaio* libgcc* libstdc++* make* sysstat* unixODBC* wget unzip
```

## 5.关闭防火墙 CentOS 7.2默认使用的是firewall作为防火墙

``` gauss
$ systemctl disable firewalld
$ systemctl stop firewalld
```

## 6.关闭selinux（需重启生效）

``` ini
[root@localhost /]# vi /etc/selinux/config
[root@localhost /]# cat /etc/selinux/config

# This file controls the state of SELinux on the system.
# SELINUX= can take one of these three values:
#     enforcing - SELinux security policy is enforced.
#     permissive - SELinux prints warnings instead of enforcing.
#     disabled - No SELinux policy is loaded.
SELINUX=disabled   #此处修改为disabled
# SELINUXTYPE= can take one of three two values:
#     targeted - Targeted processes are protected,
#     minimum - Modification of targeted policy. Only selected processes are protected. 
#     mls - Multi Level Security protection.
SELINUXTYPE=targeted
```

## 7.修改内核参数

``` nix
[sonny@localhost /]$ su root
Password: 
[root@localhost /]# vi /etc/sysctl.conf 
[root@localhost /]# cat /etc/sysct.conf


cat: /etc/sysct.conf: No such file or directory
[root@localhost /]# cat /etc/sysctl.conf 
# System default settings live in /usr/lib/sysctl.d/00-system.conf.
# To override those settings, enter new settings here, or in an /etc/sysctl.d/<name>.conf file
#
# For more information, see sysctl.conf(5) and sysctl.d(5).
net.ipv4.icmp_echo_ignore_broadcasts = 1
net.ipv4.conf.all.rp_filter = 1
fs.file-max = 6815744 #设置最大打开文件数
fs.aio-max-nr = 1048576
kernel.shmall = 2097152 #共享内存的总量，8G内存设置：2097152*4k/1024/1024
kernel.shmmax = 2147483648 #最大共享内存的段大小
kernel.shmmni = 4096 #整个系统共享内存端的最大数
kernel.sem = 250 32000 100 128
net.ipv4.ip_local_port_range = 9000 65500 #可使用的IPv4端口范围
net.core.rmem_default = 262144
net.core.rmem_max= 4194304
net.core.wmem_default= 262144
net.core.wmem_max= 1048576
[root@localhost /]#
```


``` nix
使配置参数生效

[root@localhost /]# sysctl -p

net.ipv4.icmp_echo_ignore_broadcasts = 1
net.ipv4.conf.all.rp_filter = 1
sysctl: setting key "fs.file-max": Invalid argument
fs.file-max = 6815744 #设置最大打开文件数
fs.aio-max-nr = 1048576
sysctl: setting key "kernel.shmall": Invalid argument
kernel.shmall = 2097152 #共享内存的总量，8G内存设置：2097152*4k/1024/1024
sysctl: setting key "kernel.shmmax": Invalid argument
kernel.shmmax = 2147483648 #最大共享内存的段大小
sysctl: setting key "kernel.shmmni": Invalid argument
kernel.shmmni = 4096 #整个系统共享内存端的最大数
kernel.sem = 250 32000 100 128
sysctl: setting key "net.ipv4.ip_local_port_range": Invalid argument
net.ipv4.ip_local_port_range = 9000 65500 #可使用的IPv4端口范围
net.core.rmem_default = 262144
net.core.rmem_max = 4194304
net.core.wmem_default = 262144
net.core.wmem_max = 1048576
[root@localhost /]#
```

## 8.解压安装包

``` elixir
[oracle@localhost /]$ cd /usr/local/src　　#进入/usr/local/src目录
[oracle@localhost src]$ ls
linux.x64_11gR2_database_1of2.zip  linux.x64_11gR2_database_2of2.zip
[oracle@localhost src]$ unzip linux.x64_11gR2_database_1of2.zip -d /data/database/　　#解压
(省略...)
[oracle@localhost src]$ unzip linux.x64_11gR2_database_2of2.zip -d /data/database/　　#解压
(省略...)
[oracle@localhost src]$ su root
Password: 
[root@localhost src]# chown -R oracle:oinstall /data/database/database/
[root@localhost src]#
```

# 二、oracle安装 

1.图形界面登陆oracle用户：

> 备注：root用户切换到oracle用户无法安装报错，必须使用oracle直接登录，否则报如下错误
> 
> ==Exception in thread “main” java.lang.NoClassDefFoundError==

![enter description here](1.png)

2.启动oralce安装，到/data/database/database/目录下，执行runInstaller
 ![enter description here](2.png)
3.去掉勾，懒得填，个人使用环境不需要自动接收Oracle的安全更新。
 ![enter description here](3.png)
4.下一步，只安装数据库软件，个人用不要那些玩意~~ 
![enter description here](4.png)
5.选择单例安装，前面的所有配置均为单例安装。
 ![enter description here](5.png)
6.添加语言
![enter description here](6.png)
7.默认安装版本企业版-Enterprise Edition 
8.确定数据软件的安装路径，自动读取前面Oracle环境变量中配置的值。
![enter description here](8.png)
9.理论上要创建Database Operation（OSOPER）Group:oper ,个人用，懒得建，就使用dba用户组
![enter description here](9.png)
10.安装检查，按照提示信息一个一个解决。
![enter description here](10.png)
11.一个一个检查package，在准备阶段中漏掉的，此处再安装，有些系统报错是因为现有的包的版本比检测要高，最后忽略即可。（点击Check_Again 多检查几次）
![enter description here](11.png)
12.准备完毕，fuck “Finish”开始安装。
![enter description here](12.png)
14.提示安装成功。安装日志懒得看，再说。
![enter description here](14.png)

# 三、配置监听listener

1.执行netca 报错

``` prolog
[@localhost ~]$ netca

Oracle Net Services Configuration:
#
# An unexpected error has been detected by HotSpot Virtual Machine:
#
#  SIGSEGV (0xb) at pc=0x00007f69a69fcb9d, pid=8033, tid=140092892297024
#
# Java VM: Java HotSpot(TM) 64-Bit Server VM (1.5.0_17-b03 mixed mode)
# Problematic frame:
# C  [libclntsh.so.11.1+0x62ab9d]  snlinGetAddrInfo+0x1b1
#
# An error report file with more information is saved as hs_err_pid8033.log
#
# If you would like to submit a bug report, please visit:
#   http://java.sun.com/webapps/bugreport/crash.jsp
#
/data/oracle/product/11.2.0/db_1/bin/netca: line 178:  8033 Aborted                 (core dumped) $JRE $JRE_OPTIONS -classpath $CLASSPATH oracle.net.ca.NetCA $*
[oracle@localhost ~]$
```
错误原因：安装操作系统是默认主机名localhost造成错误

解决办法：

``` gherkin
[racle]# cat /etc/sysconfig/network
# Created by anaconda

[root@localhost oracle]# vi /etc/sysconfig/network　　#增加HOSTNAME
[root@localhost oracle]# cat /etc/sysconfig/network
# Created by anaconda
HOSTNAME=odb-sonny
[root@localhost oracle]# cat /etc/hosts
127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4
::1         localhost localhost.localdomain localhost6 localhost6.localdomain6
[root@localhost oracle]# vi /etc/hosts　　#增加HOSTNAME</strong>
[root@localhost oracle]# cat /etc/hosts     
127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4 odb-sonny
::1         localhost localhost.localdomain localhost6 localhost6.localdomain6
[root@localhost oracle]# hostname odb-sonny　　#执行
[root@localhost oracle]#
```
最后注销当前oracle用户，重新登陆即可！！这次发现打开配置界面正常，安装windows下面配置即可。
![enter description here](15.png)

# 四、创建Oracle数据实例Orcl

执行dbca命令，启动oracle实例安装界面，剩下的与Windows上安装一样，不废话了：

注意：必须先创建监听，并且监听是启动中，否则报错。
![enter description here](16.png)

# 问题总结

## 问题一：

root用户切换到oracle用户无法安装报错，必须使用oracle直接登录，否则报如下错误

***Exception in thread “main” java.lang.NoClassDefFoundError***

## 问题二：

Oracle 安装报错 ***[INS-06101] IP address of localhost could not be determined*** 解决方法

出现这种错误是因为主机名和/etc/hosts 文件不一致，只需要把主机名和其IP 写入/etc/hosts 文件，就ok了。

## 问题三：

在ORACLE11G R2 安装ORACLE时出现以下错误：

***[INS-08109] Unexpected error occurred while validating inputs at state ‘getOCMDetails’.***

经GOOGLE看到

http://www.linkedin.com/groups/I-try-clone-oracle-grid-77941.S.38808726

说是使用了 LD_LIBRARY_PATH 环境参数，经查看.bash_profile ，有如下设置：

LD_LIBRARY_PATH=$ORACLE_HOME/lib:/lib:/usr/lib; export LD_LIBRARY_PATH

注释掉后，问题解决。

## 问题四：

***“#Error in invoking target ‘install’ of makefile ‘/data/oracle/product/11.2.0/db_1/ctx/lib/ins_ctx.mk’”***
解决方法：打开一个新的终端，使用root身份登入，
#vi ORACLE_HOME/ctx/lib/ins_ctx.mk
找到
ctxhx: $(CTXHXOBJ)
$(LINK_CTXHX) $(CTXHXOBJ) $(INSO_LINK)
修改为(添加红色部分):                   ctxhx: $(CTXHXOBJ)
***-static***  $(LINK_CTXHX) $(CTXHXOBJ) $(INSO_LINK)  ***/usr/lib64/libc.a***

## 问题五：

***“#Error in invoking target ‘agent nmhs’ of makefile ‘/home/oracle_11/app/oracle/product/11.2.0/db_1/sysman/lib/ins_emagent.mk’”***
解决方法：打开一个新的终端，使用root身份登入，
#vi $ORACLE_HOME/sysman/lib/ins_emagent.mk
找到
$(MK_EMAGENT_NMECTL)
修改为(添加红色部分)：
$(MK_EMAGENT_NMECTL) ==-lnnz11==
完成后在错误提示框上retry既可