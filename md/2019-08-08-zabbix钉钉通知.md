---
title: zabbix钉钉通知(插件版)
tags:
 - zabbix
 - 钉钉
categories:
 - Linux
copyright: true
date: 2019-08-08 10:18:03
---
# 1 安装插件
<!--more-->
下载插件`webhook-zabbix-robot-64`到`/usr/lib/zabbix/alertscripts/`路径
# 2 创建`报警媒介类型`
{%note info%}
脚本名称：插件或脚本的名字
脚本参数：
-webhook=https://oapi.dingtalk.com/robot/send?access_token=92bfa50db10658ee1c37f9ab6b7a000e14ce94a901002170762e472af3754fbf
-msg={ALERT.MESSAGE}
-url=http://192.168.0.10/zabbix/
-log=/tmp/dingding.log
{%endnote%}
![1](1.jpg)
# 3 配置用户告警
## 3.1 配置告警媒介
添加告警媒介，使用户可接收告警信息，及设置接收信息重要性
![2](2.jpg)
## 3.2 配置权限
用户只接收有权限的主机告警
![3](3.jpg)
# 4 创建`动作`
 - 触发条件
 ![4](4.jpg)
 - 操作
 **消息内容：**
 

``` xml
<?xml version="1.0" encoding="UTF-8" ?>
<root>
  <from>{HOST.NAME}</from>
  <time>{EVENT.DATE} {EVENT.TIME}</time>
  <level>{TRIGGER.SEVERITY}</level>
  <name>{TRIGGER.NAME}</name>
  <key>{TRIGGER.KEY1}</key>
  <value>{ITEM.VALUE}</value>
  <now>{ITEM.LASTVALUE}</now>
  <id>{EVENT.ID}</id>
  <ip>{HOST.IP}</ip>
  <url>http://192.168.0.10/zabbix</url>
  <age>{EVENT.AGE}</age>
  <status>{EVENT.STATUS}</status>
<acknowledgement> {EVENT.ACK.STATUS} </acknowledgement>
<acknowledgementhistory> {EVENT.ACK.HISTORY}</acknowledgementhistory>
</root>
```
 ![5](5.jpg)
 - 恢复操作
 **消息内容：**
 

``` xml
<?xml version="1.0" encoding="UTF-8" ?>
<root>
  <from>{HOST.NAME}</from>
  <time>{EVENT.DATE} {EVENT.TIME}</time>
  <level>{TRIGGER.SEVERITY}</level>
  <name>{TRIGGER.NAME}</name>
  <key>{TRIGGER.KEY1}</key>
  <value>{ITEM.VALUE}</value>
  <now>{ITEM.LASTVALUE}</now>
  <id>{EVENT.ID}</id>
  <ip>{HOST.IP}</ip>
  <color>FF4A954A</color>
  <url>http://192.168.0.10/zabbix</url>
  <age>{EVENT.AGE}</age>
  <recoveryTime>{EVENT.RECOVERY.DATE} {EVENT.RECOVERY.TIME}</recoveryTime>
  <status>OK</status>
</root>
```
![6](6.jpg)

- 告警确认或更新

**消息内容：**
``` xml
报警确认：{HOST.NAME}
------------
确认人：{USER.FULLNAME} 
时间：{ACK.DATE} {ACK.TIME} 
确认信息如下：
"{ACK.MESSAGE}"
问题服务器IP：{HOSTNAME1}
问题ID：{EVENT.ID}
当前的问题是： {TRIGGER.NAME}
```
![7](7.jpg)
{%note info%}**备注**
这个告警使用的使python脚本，非通过插件，可观察上图`仅送到`信息，本文结尾上传插件和脚本，同时添加告警媒介python版
![8](8.jpg)
脚本参数：
{ALERT.MESSAGE}
{ALERT.SENDTO}
{ALERT.SUBJECT}
{%endnote%}
# 5 附件
=[dingding.py](dingding.py)
=[webhook-zabbix-robot-64](webhook-zabbix-robot-64)