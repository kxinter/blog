---
title: Ubuntu同步源仓库到本地
tags:
  - 私有仓库
categories:
  - Linux
copyright: true
date: 2018-08-27 16:55:07
---

# 1 步骤
<!--more-->
## 1.1 安装apt-mirror

``` vbscript
sudo apt-get install apt-mirro
```

## 1.2 创建下载目录

``` r
#路径自定义
.../ubuntu
.../ubuntu/mirror
.../ubuntu/skel
.../ubuntu/var
```

## 1.3 修改配置文件

``` vim
sudo vi /etc/apt/mirror.list
```

```dsconfig
############# config ##################
#
set base_path    /home/packages/ubuntu
#
set mirror_path  $base_path/mirror
set skel_path    $base_path/skel
set var_path     $base_path/var
set cleanscript $var_path/clean.sh
set nthreads     20
set _tilde 0
#
############# end config ##############

#deb http://archive.ubuntu.com/ubuntu trusty main restricted universe multiverse
#deb http://archive.ubuntu.com/ubuntu trusty-security main restricted universe multiverse
#deb http://archive.ubuntu.com/ubuntu trusty-updates main restricted universe multiverse
#deb http://archive.ubuntu.com/ubuntu trusty-proposed main restricted universe multiverse
#deb http://archive.ubuntu.com/ubuntu trusty-backports main restricted universe multiverse

#deb-src http://archive.ubuntu.com/ubuntu trusty main restricted universe multiverse
#deb-src http://archive.ubuntu.com/ubuntu trusty-security main restricted universe multiverse
#deb-src http://archive.ubuntu.com/ubuntu trusty-updates main restricted universe multiverse
#deb-src http://archive.ubuntu.com/ubuntu trusty-proposed main restricted universe multiverse
#deb-src http://archive.ubuntu.com/ubuntu trusty-backports main restricted universe multiverse

#clean http://archive.ubuntu.com/ubuntu


#自定义
#参考以下配置文件：
#清空原有的配置文件，直接使用以下配置文件即可

############# config ##################
# 以下注释的内容都是默认配置，如果需要自定义，取消注释修改即可
#set base_path /var/spool/apt-mirror
#
# 镜像文件下载地址
# set mirror_path $base_path/mirror
# 临时索引下载文件目录，也就是存放软件仓库的dists目录下的文件（默认即可）
# set skel_path $base_path/skel
# 配置日志（默认即可）
# set var_path $base_path/var
# clean脚本位置
# set cleanscript $var_path/clean.sh
# 架构配置，i386/amd64，默认的话会下载跟本机相同的架构的源
#set defaultarch amd64
# set postmirror_script $var_path/postmirror.sh
# set run_postmirror 0
# 下载线程数
#set nthreads 20
#set _tilde 0
#
############# end config ##############
# Ali yun（这里没有添加deb-src的源）
#我们把常用的软件同步过来就够用了
deb http://mirrors.aliyun.com/ubuntu/ trusty main restricted universe multiverse
deb http://mirrors.aliyun.com/ubuntu/ trusty-security main restricted universe multiverse
deb http://mirrors.aliyun.com/ubuntu/ trusty-updates main restricted universe multiverse
deb http://mirrors.aliyun.com/ubuntu/ trusty-proposed main restricted universe multiverse
deb http://mirrors.aliyun.com/ubuntu/ trusty-backports main restricted universe multiverse

#当某些软件包在服务器端进行了升级，或者服务器端不再需要这些软件包时，我们使用了 apt-mirror与服务器同步后，会在本地的$var_path/下生成一个clean.sh的脚本，列出了遗留在本地的旧版本和无用的软件包，你可 以手动运行这个脚本来删除遗留在本地的且不需要用的软件包
clean http://mirrors.aliyun.com/ubuntu
```
如果用amd64位架构下的包，可以加上deb-amd64的标记
如果什么都不加，直接使用deb http.....这种格式，则在同步时，只同步当前系统所使用的架构下的软件包。比如一个64位系统，直接debhttp....只同步64位的软件 包。如果还嫌麻烦，直接去改set defaultarch  <running hostarchitecture>这个参数就好，比如改成set defaultarch i386，这样你使用debhttp.....这种格式，则在同步时，只同步i386的软件包了。

如果你还想要源码，可以把源码也加到mirror.list里面同步过来，比如加上deb-src这样的标记。想要其他的东西也可以追加相应的标记来完成。

## 1.4 同步源

配置好后我们就可以和指定的镜像进行同步了

``` ebnf
sudo apt-mirror
```

## 1.5 建立本地源

参考：Ubuntu部署本地源仓库

# 2 参考资料

http://www.linuxidc.com/Linux/2014-08/105415.htm

https://www.iyunv.com/thread-384273-1-1.html