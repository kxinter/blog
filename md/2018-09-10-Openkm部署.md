---
title: Openkm部署
tags:
  - openkm
  - 部署
categories:
  - Linux
copyright: true
date: 2018-09-10 17:29:43
---

#  1 环境：
<!--more-->
系统：Centos7.1

软件：openkm-6.3.1-community-linux-x64-installer.run

辅助插件：Apache_OpenOffice_4.1.2_Linux_x86-64_install-rpm_zh-CN.tar.gz

数据库：mariadb-5.5.47-1.el7_2.x86_64

# 2 安装步骤

## 2.1 数据库安装

``` scala
[root@bogon openkm]# yum install mysql  -y        //yum安装数据库
```
//登录数据库
![1](1.png)
![2](2.png)




``` n1ql
MariaDB [(none)]> CREATE DATABASE okmdb DEFAULT CHARACTER SET utf8 DEFAULT COLLATE utf8_bin;               //创建okmdb数据库,支持utf8
```
![3](3.png)



``` livecodeserver
MariaDB [(none)]> grant all on okmdb.* to openkm@localhost identified by 'openkm';
//创建本地用户并赋予数据库okmdb所有权限


MariaDB [(none)]> flush privileges;                      ///刷新权限
```

## 2.2 openKM安装

``` lsl
[root@bogon openkm]# chmod 755 openkm-6.3.1-community-linux-x64-installer.run

//赋予安装包权限

[root@bogon openkm]# ./openkm-6.3.1-community-linux-x64-installer.run   //安装软件
```

### 2.2.1  配置数据库迁移（数据库由HSQL迁移到mysql）

``` lsl
[root@bogon openkm]# vi /opt/openkm-6.3.1-community/tomcat/OpenKM.cfg
```
![4](4.png)


//修改`HSQLDialect`（代表HSQL数据库）为`MySQL5Dialect`（代表mysql数据库）,   `none`改为`create`(初始化数据库)。

``` vim
[root@bogon openkm]# vi /opt/openkm-6.3.1-community/tomcat/conf/server.xml
```

//修改配置文件
![5](5.png)


//修改mysql相关

### 2.2.2 修改web浏览端口号

``` vim
[root@bogon openkm]# vi /opt/openkm-6.3.1-community/tomcat/conf/server.xml
```
![6](6.png)

# 3 办公插件安装

## 3.1 Openoffice安装

软件下载地址：http://www.openoffice.org/download/index.html

``` scala
[root@bogon openkm]# wget http://freefr.dl.sourceforge.net/project/openofficeorg.mirror/4.1.2/binaries/zh-CN/Apache_OpenOffice_4.1.2_Linux_x86-64_install-rpm_zh-CN.tar.gz

//下载安装包


[root@bogon openkm]# tar -zxvf Apache_OpenOffice_4.1.2_Linux_x86-64_install-rpm_zh-CN.tar.gz

//解压缩安装包

[root@bogon openkm]# cd zh-CN/RPMS/            // 进入解压后的目录

[root@bogon RPMS]# rpm -Uvih *rpm              //安装新版本，默认将会安装/升级Apache OpenOffice到/opt目录
```
![7](7.png)

修改配置，指向`openoffice`安装目录，实现office文档预览。

## 3.2 swftools安装

``` typescript
[root@bogon openkm]# yum install gcc* automake zlib-devel libjpeg-devel giflib-devel freetype-devel

//安装所需的库和组件

[root@bogon openkm]# wget http://www.swftools.org/swftools-0.9.2.tar.gz

//下载安装包

[root@bogon openkm]# tar vxzf swftools-0.9.2.tar.gz        //解压安装包

[root@bogon openkm]# cd swftools-0.9.2/                      //进入解压目录

[root@bogon swftools-0.9.2]# ./configure --prefix=/usr/local/swftools

//编辑文件，并指定安装位置

[root@bogon swftools-0.9.2]# make install                  //安装
```

**报错：**

![8](8.png)

**解决办法：**

修改`swftools-0.9.2/swfs`下的

`Makefile`和`Makefile.in`文件； 

<div class="note info no-cion"><p>install:
$(mkinstalldirs) $(pkgdatadir)
$(mkinstalldirs) $(pkgdatadir)/swfs
$(INSTALL_DATA) ./simple_viewer.swf $(pkgdatadir)/swfs/simple_viewer.swf
$(INSTALL_DATA) ./keyboard_viewer.swf $(pkgdatadir)/swfs/keyboard_viewer.swf
$(INSTALL_DATA) ./PreLoaderTemplate.swf $(pkgdatadir)/swfs/PreLoaderTemplate.swf
$(INSTALL_DATA) ./tessel_loader.swf $(pkgdatadir)/swfs/tessel_loader.swf
$(INSTALL_DATA) ./swft_loader.swf $(pkgdatadir)/swfs/swft_loader.swf
`rm -f $(pkgdatadir)/swfs/default_viewer.swf -o -L $(pkgdatadir)/swfs/default_viewer.swf`
$(LN_S) $(pkgdatadir)/swfs/simple_viewer.swf $(pkgdatadir)/swfs/default_viewer.swf
`rm -f $(pkgdatadir)/swfs/default_loader.swf -o -L $(pkgdatadir)/swfs/default_loader.swf`
$(LN_S) $(pkgdatadir)/swfs/tessel_loader.swf $(pkgdatadir)/swfs/default_loader.swf</p></div>

将两个文件中的标记红色的` -o -L` 去掉；

然后删除安装目录`/usr/local/swftools`,重新编译安装即可；

``` lsl
[root@bogon swftools-0.9.2]# vi /etc/profile


//编辑文件，添加如下内容，设置swftools环境变量，使pdf2swf成为一个可执行命令

export PATH=$PATH:/usr/local/swftools/bin/
```
安装xpdf语言包。下载[xpdf-chinese-simplified.tar.gz](ftp://ftp.foolabs.com/pub/xpdf/xpdf-chinese-simplified.tar.gz)文件，解压到`/usr/local`下，编辑`add-to-xpdfrc`文件，如下：

``` vim
[root@bogon ~]# vi /usr/local/xpdf-chinese-simplified/add-to-xpdfrc
```

//编辑文件

``` groovy
fontDir /usr/share/fonts/win 
displayCIDFontTT Adobe-GB1 /usr/share/fonts/win/simhei.ttf
```
![9](9.png)
//管理-配置-编辑路径

## 3.3 ImageMagick安装

``` scala
[root@bogon ~]# yum install ImageMagick –y                //yum安装插件
```
![10](10.png)

//管理-配置-添加路径

# 4 资料

linux-安装openkm6.3.doc

xpdf-chinese-simplified.tar.gz

swftools-0.9.2.tar.gz

OpenKM_6_zh-CN.rar

链接: [所有相关文件](http://pan.baidu.com/s/1slFGCOl) 密码: iryc