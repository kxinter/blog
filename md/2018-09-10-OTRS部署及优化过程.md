---
title: OTRS部署及优化过程
tags:
  - otrs
  - 工单
  - 部署
categories:
  - Linux
copyright: true
date: 2018-09-10 16:58:06
---

# 1 环境
<!--more-->
系统：centos 7.2 1511

Otrs：otrs-5.0.14-02.noarch.rpm

Mysql：5.5.50-MariaDB

Apache: Apache/2.4.6

# 2 安装步骤

## 2.1 禁用SELinux

在文件`/etc/selinux/config`中配置`SELINUX=disabled`

``` elixir
[root@drbd2 home]# vi /etc/selinux/config
```
![1](1.png)

重启系统。重启后确认命令getenforce返回为Disabled

![2](2.png)

## 2.2 安装数据库

``` sql
[root@drbd2 home] yum -y install   mariadb-server
```

这会在你的系统上使用默认选项安装MySQL，你需要修改默认设置以适用于OTRS。使用文本编辑器来

创建一个新文件`/etc/my.cnf.d/zotrs.cnf`，包含如下内容：

![3](3.png)
![4](4.png)

现在执行`systemctl start mariadb`来重启数据库服务器并激活刚才的修改内容。然后运行命令`/usr/bin/mysql_secure_installation`，并按照屏幕上的指令来设置数据库的root密码、移除匿名访问及删除test数据库。

## 2.3 安装otrs

使用`yum`通过命令行来安装`OTRS`，它还会拉入一些依赖包如`Apache WEB`服务器和一些`Perl模块`。
<div class=“note success”><p>备注
确保你已经将OTRS RPM文件复制到了当前目录。(必须在otrsrpm安装包的目录运行安装命令)</p></dir>

``` css
[root@drbd2 home]# yum install   --nogpgcheck otrs-5.0.14-02.noarch.rpm
```

现在使用命令`systemctl restart httpd.service`重启`Apache`以载入为`OTRS`修改的配置。

## 2.4 安装额外的perl模块

除了通过`RPM包`安装的`Perl模块`外，`OTRS`还需要一些其它的`Perl模块`，你可以手动安装。通过执行位于目录`/opt/otrs`下的文件`bin/otrs.CheckModules.pl`来检查缺失的模块。一些模块只是可选的功能才需要，比如与`IMAP`服务器通讯或生成`PDF`。具体可参考《OTRS-4.0.5系统安装手册 otrs_5.0_管理员说明书》。

## 2.5 使用Web安装器

在安装完`OTRS`软件后，你可以使用`OTRS`的`WEB安装器`来设置和配置`OTRS数据库`。WEB安装器是一个能通过浏览器访问的WEB页面。WEB安装器的地址是：http://localhost/otrs/installer.pl 。

启动WEB安装器后，请跟随下面的步骤来设置你的系统：

1、 检验OTRS办公室信息并点击‘下一步’以继续（见下图）。
![5](5.png)


2、 阅读GNU Affero通用公共许可证（见下图）并页面底部的相应按钮接受许可。
![6](6.png)


3、 选择你要在OTRS中使用的数据库。如果你选择`MySQL`或`PostgreSQL`，你还能在这里选择是通过WEB安装器新建一个数据库还是使用你的数据库管理员已经创建好的空数据库。

![7](7.png)

4、 根据你选择的数据库的不同，以及在上一步中是用WEB安装器新建数据库还是使用已有数据库，这个窗口可用有一点点差异。在这个窗口输入数据库认证信息。

![8](8.png)

5、 创建一个新的数据库用户，选择一个数据库名称，并点击‘下一步’（见下图）。

<div class="note info"><p>OTRS会为你生成一个强密码，当然如果你愿意也可以输入你自己的密码。这个密码会写入到配置文件Kernel/Config.pm，所以无需记住这个密码。</p></div>
![9](9.png)
6、 如果需要会创建数据库，并填充相应数据，如图所示。点击‘下一步’进入下一个窗口。
![10](10.png)


7、 提供所有必填的系统设置，并点击‘下一步’（如下图）。

![11](11.png)

8、 若需要，你可以提供需要的数据来配置收发邮件，或者点击窗口底部右边的按钮跳过这一步（如下图）。

<div class="note info"><p>暂时先跳过这一步，后期在进行配置。</p></div>
![12](12.png)


9、 记录管理员密码，安装完成。

![13](13.png)

## 2.6 登陆地址

服务人员登录地址：http://172.20.22.108/otrs/index.pl

客户登陆地址：http://172.20.22.108/otrs/customer.pl

# 3 备份与恢复

## 3.1 备份

有两种类型的数据需要备份：应用程序文件（如`/opt/otrs`目录下的文件）和存储在`数据库`中的数据。

为了简化备份，在每个OTRS安装中已经包括了脚本`scripts/backup.pl`。运行它可以备份所有重要的数据。

``` jboss-cli
[root@drbd2   scripts]# ./backup.pl -d /home/

Backup   /home//2016-12-13_13-18/Config.tar.gz ... done

Backup /home//2016-12-13_13-18/Application.tar.gz   ... done

Dump MySQL   rdbms ... done

Compress   SQL-file... done
```

所有数据都保存在目录`/home/2016-12-13_13-18/`下。另外，这些数据被保存到一个`.tar.gz文件`。

## 3.2 恢复

要恢复一个备份，保存的应用程序数据必须被写回到安装目录，如`/opt/otrs`。还必须要恢复数据库。

每个OTRS安装都自带了一个脚本文件`scripts/restore.pl`（见下面的脚本），它简化了恢复过程，支持`MySQL`和`PostgreSQL`。

<div class="note danger"><p>恢复要求数据库为空</p></div>

``` lsl
[root@drbd2 scripts]# ./restore.pl -b   /home/2016-12-13_13-18 -d /opt/otrs

Restore /home/2016-12-13_13-18//Config.tar.gz   ...

Restore /home/2016-12-13_13-18//Application.tar.gz   ...

create MySQL

decompresses SQL-file ...

cat SQL-file into MySQL database

compress SQL-file...
```

# 4 优化

## 4.1 开启工单关注

系统配置》搜索配置参数`Ticket::watcher`》激活功能。

![14](14.png)
![15](15.png)

## 4.2 PDF打印中文乱码

**解决方案**

此方法适合于`Linux，Win`系列可以直接跳过拷贝文件设定配置即可解决，也可安装其它字体。

安装中文字体

1. 从windows 7/vista/2008 系统中拷贝微软雅黑字体msyh.ttf文件

2. 将字体文件上传至/usr/share/fonts/chinese/TrueType/msyh.ttf

3. 打开OTRS配置页面

在otrs配置 `core::PDF`中添加字体文件的绝对路径` /usr/share/fonts/chinese/TrueType/msyh.ttf`

Win下可直接设定字体名称，otrs系统会自动至Fonts目录查找指定的字体用于处理中文。

进入 `OTRS to Admin > SysConfig > Framework > Core::PDF`并更新字体位置，为PDF打印选择指定的新字体

![16](16.png)

## 4.3 FAQ显示更多属性

首先，在系统配置的FAQ中选择配置项`Frontend::Agent::FAQ::ViewExplorer`。

![17](17.png)

然后在打开的页面中找到配置项`FAQ::Frontend::AgentFAQExplorer###ShowColumns`。按照下图进行配置。

![18](18.png)

最后，我们返回到FAQ浏览器页面，就可以看到FAQ文章的更多属性。


![19](19.png)


