---
title: Ubuntu部署本地源仓库
tags:
  - 部署
  - 私有仓库
categories:
  - Linux
copyright: true
date: 2018-08-27 17:03:22
---

# 1 本地源的制作
<!--more-->
## 1.1 安装所需软件包

``` q
sudo apt-get install  dpkg-dev
```


## 1.2 打包deb软件包

``` vala
#加上-d参数，只下载安装包，不安装及解压。
sudo apt-get  install -d nginx
```

将/var/cache/apt/archives/下的所有deb文件拷到/home/packages/下的Natty目录中：/home/packages/Natty，拷贝前建议执行一下:

``` vala
#autoclean - 删除已下载的旧包文件
sudo apt-get autoclean
```

## 1.3 进入指定目录上一级目录

拷完后在终端中进入刚才新建的目录Natty所在的上一级目录，也就是：

``` jboss-cli
cd /home/packages
```

生成软件包依赖信息文件

``` nginx
sudo dpkg-scanpackages Natty/ | gzip >Natty/Packages.gz
```

至此本地源的软件包已经准备完毕；下面接着介绍如何使用。

# 2 本地源的使用

## 2.1 本机源服务器的搭建

将地址加入更新源列表文件

``` vim
$ sudo vim /etc/apt/sources.list
# 添加以下路径，其它deb信息使用#号注释掉
deb file:///home/packages/ Natty/
```

> #注意Natty后面有一个斜杠,前面还要有空格(这是书写方式)

## 2.2 更新源信息

``` vala
#更新信息，生成数据缓存
$ sudo apt-get update
```

之后即可正常安装所需软件。

# 3 局域网源服务器

## 3.1 安装apache2

``` vbscript
sudo apt-get install apache2
```
<!--more-->
启动服务

> 注意：配置apache2的时候注意端口，不要配置成可能被其他网络应用使用的端口就可以。

## 3.2 配置服务器上的Ubuntu源

``` awk
#在apache2发布目录/var/www/html位置创建到源目录的软链接
sudo ln -s /home/packages/Natty/ /var/www/html/ubuntu-local
```

## 3.3 配置局域网客户机sources.list

``` vala
$ sudo vim /etc/apt/sources.list
#添加如下信息,其它deb信息使用#号注释掉
deb http://192.168.1.224 ubuntu-local/   
#注意书写方式，ip地址后空格，目录地址/
```

## 3.4 客户机更新源信息

``` vala
#更新信息，生成数据缓存
sudo apt-get update
```

之后即可正常安装所需软件。
# 4 参考资料

https://www.iyunv.com/thread-384273-1-1.html